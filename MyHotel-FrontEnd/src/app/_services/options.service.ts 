import { Injectable } from '@angular/core';
import { Headers, Http, BaseRequestOptions } from '@angular/http';
import { TOKEN_NAME,AuthenticationService } from './authentication.service';

const AUTH_HEADER_KEY = 'Authorization';
const AUTH_PREFIX = 'Bearer';

@Injectable()
export class DefaultRequestOptions extends BaseRequestOptions {
  
  constructor() {
    super();
    
    const token = localStorage.getItem(TOKEN_NAME);
    if(token) {
      this.headers.append(AUTH_HEADER_KEY, `${AUTH_PREFIX} ${token}`);
    } 
    // Set the default 'Authorization' header
    //this.headers.set('Authorization', `Bearer ${authenticationService.token}`);
    
    // Update: You need to subscribe to an observable that will update the JWT. Otherwise, it will run only once.
    // Something like:
// AuthService.user.subscribe(user => this.headers.set('Authorization', `Bearer ${user.token}`);)
  
  }

}
//export const requestOptionsProvider = { provide: RequestOptions, useClass: DefaultRequestOptions };
